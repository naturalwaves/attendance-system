<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Analytics Dashboard</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #1a1a2e 0%, #16213e 100%);
            min-height: 100vh;
            color: #fff;
        }
        
        /* Alert Banner Styles */
        .alert-banner {
            padding: 12px 20px;
            display: flex;
            align-items: center;
            justify-content: space-between;
            font-weight: 500;
            display: none;
        }
        
        .alert-banner.show {
            display: flex;
        }
        
        .alert-banner.danger {
            background: linear-gradient(135deg, #e74c3c, #c0392b);
        }
        
        .alert-banner.warning {
            background: linear-gradient(135deg, #f39c12, #d68910);
        }
        
        .alert-banner.success {
            background: linear-gradient(135deg, #27ae60, #1e8449);
        }
        
        .alert-banner .alert-content {
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .alert-banner .alert-icon {
            font-size: 1.2rem;
        }
        
        .alert-banner .alert-close {
            background: rgba(255,255,255,0.2);
            border: none;
            color: white;
            width: 28px;
            height: 28px;
            border-radius: 50%;
            cursor: pointer;
            font-size: 1rem;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: background 0.3s;
        }
        
        .alert-banner .alert-close:hover {
            background: rgba(255,255,255,0.3);
        }
        
        .header {
            background: rgba(255,255,255,0.1);
            backdrop-filter: blur(10px);
            padding: 20px 40px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            border-bottom: 1px solid rgba(255,255,255,0.1);
        }
        
        .logo {
            font-size: 1.5rem;
            font-weight: bold;
            color: #4facfe;
        }
        
        .nav-links {
            display: flex;
            gap: 30px;
            align-items: center;
        }
        
        .nav-links a {
            color: #fff;
            text-decoration: none;
            opacity: 0.8;
            transition: opacity 0.3s;
        }
        
        .nav-links a:hover {
            opacity: 1;
        }
        
        .clock-container {
            display: flex;
            align-items: center;
            gap: 20px;
        }
        
        .analog-clock {
            width: 50px;
            height: 50px;
            border: 2px solid #4facfe;
            border-radius: 50%;
            position: relative;
            background: rgba(0,0,0,0.3);
        }
        
        .clock-hand {
            position: absolute;
            bottom: 50%;
            left: 50%;
            transform-origin: bottom center;
            background: #fff;
            border-radius: 2px;
        }
        
        .hour-hand {
            width: 3px;
            height: 12px;
            margin-left: -1.5px;
        }
        
        .minute-hand {
            width: 2px;
            height: 16px;
            margin-left: -1px;
        }
        
        .second-hand {
            width: 1px;
            height: 18px;
            margin-left: -0.5px;
            background: #4facfe;
        }
        
        .clock-center {
            position: absolute;
            width: 6px;
            height: 6px;
            background: #4facfe;
            border-radius: 50%;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
        }
        
        .digital-clock {
            font-size: 1.2rem;
            font-family: 'Courier New', monospace;
            color: #4facfe;
        }
        
        .main-content {
            padding: 30px 40px;
        }
        
        .welcome-section {
            margin-bottom: 30px;
        }
        
        .welcome-section h1 {
            font-size: 1.8rem;
            margin-bottom: 5px;
        }
        
        .welcome-section p {
            opacity: 0.7;
        }
        
        .dashboard-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }
        
        .stat-card {
            background: rgba(255,255,255,0.1);
            backdrop-filter: blur(10px);
            border-radius: 15px;
            padding: 25px;
            border: 1px solid rgba(255,255,255,0.1);
            transition: transform 0.3s, box-shadow 0.3s;
        }
        
        .stat-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 40px rgba(0,0,0,0.3);
        }
        
        .stat-card .stat-icon {
            font-size: 2rem;
            margin-bottom: 10px;
        }
        
        .stat-card .stat-number {
            font-size: 2.5rem;
            font-weight: bold;
            margin-bottom: 5px;
        }
        
        .stat-card .stat-label {
            opacity: 0.7;
            font-size: 0.9rem;
        }
        
        .stat-card.schools { border-left: 4px solid #4facfe; }
        .stat-card.staff { border-left: 4px solid #a29bfe; }
        .stat-card.present { border-left: 4px solid #00b894; }
        .stat-card.late { border-left: 4px solid #fdcb6e; }
        .stat-card.absent { border-left: 4px solid #e74c3c; }
        
        .content-grid {
            display: grid;
            grid-template-columns: 2fr 1fr;
            gap: 30px;
        }
        
        .card {
            background: rgba(255,255,255,0.1);
            backdrop-filter: blur(10px);
            border-radius: 15px;
            padding: 25px;
            border: 1px solid rgba(255,255,255,0.1);
        }
        
        .card h3 {
            margin-bottom: 20px;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .branch-table {
            width: 100%;
            border-collapse: collapse;
        }
        
        .branch-table th,
        .branch-table td {
            padding: 12px;
            text-align: left;
            border-bottom: 1px solid rgba(255,255,255,0.1);
        }
        
        .branch-table th {
            opacity: 0.7;
            font-weight: 500;
        }
        
        .branch-row {
            cursor: pointer;
            transition: background 0.3s;
        }
        
        .branch-row:hover {
            background: rgba(255,255,255,0.05);
        }
        
        .branch-row td:first-child {
            position: relative;
            padding-left: 25px;
        }
        
        .branch-row td:first-child::before {
            content: '‚ñ∂';
            position: absolute;
            left: 8px;
            font-size: 0.7rem;
            transition: transform 0.3s;
            color: #4facfe;
        }
        
        .branch-row.expanded td:first-child::before {
            transform: rotate(90deg);
        }
        
        .staff-details {
            display: none;
        }
        
        .staff-details.expanded {
            display: table-row;
        }
        
        .staff-list {
            background: rgba(0,0,0,0.2);
            border-radius: 10px;
            padding: 15px;
            margin: 10px 0;
        }
        
        .staff-table {
            width: 100%;
            border-collapse: collapse;
        }
        
        .staff-table th,
        .staff-table td {
            padding: 10px;
            text-align: left;
            border-bottom: 1px solid rgba(255,255,255,0.05);
        }
        
        .staff-table th {
            opacity: 0.6;
            font-size: 0.85rem;
        }
        
        .staff-table tr:nth-child(even) {
            background: rgba(255,255,255,0.03);
        }
        
        .staff-table tr:hover {
            background: rgba(255,255,255,0.08);
        }
        
        .badge {
            padding: 4px 12px;
            border-radius: 20px;
            font-size: 0.8rem;
            font-weight: 500;
        }
        
        .badge-success { background: rgba(0,184,148,0.2); color: #00b894; }
        .badge-warning { background: rgba(253,203,110,0.2); color: #fdcb6e; }
        .badge-danger { background: rgba(231,76,60,0.2); color: #e74c3c; }
        
        .loading-spinner {
            text-align: center;
            padding: 20px;
            opacity: 0.6;
        }
        
        .activity-ticker {
            max-height: 300px;
            overflow-y: auto;
        }
        
        .activity-item {
            display: flex;
            align-items: center;
            gap: 15px;
            padding: 12px 0;
            border-bottom: 1px solid rgba(255,255,255,0.1);
        }
        
        .activity-avatar {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background: linear-gradient(135deg, #4facfe, #00f2fe);
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
        }
        
        .activity-info {
            flex: 1;
        }
        
        .activity-name {
            font-weight: 500;
            margin-bottom: 3px;
        }
        
        .activity-time {
            font-size: 0.8rem;
            opacity: 0.6;
        }
        
        .search-container {
            margin-bottom: 30px;
        }
        
        .search-box {
            display: flex;
            gap: 10px;
            max-width: 500px;
        }
        
        .search-box input {
            flex: 1;
            padding: 12px 20px;
            border: 1px solid rgba(255,255,255,0.2);
            border-radius: 25px;
            background: rgba(255,255,255,0.1);
            color: #fff;
            font-size: 1rem;
        }
        
        .search-box input::placeholder {
            color: rgba(255,255,255,0.5);
        }
        
        .search-box input:focus {
            outline: none;
            border-color: #4facfe;
        }
        
        .search-results {
            margin-top: 15px;
            display: none;
        }
        
        .search-results.show {
            display: block;
        }
        
        .search-result-item {
            display: flex;
            align-items: center;
            gap: 15px;
            padding: 15px;
            background: rgba(255,255,255,0.05);
            border-radius: 10px;
            margin-bottom: 10px;
            transition: background 0.3s;
        }
        
        .search-result-item:hover {
            background: rgba(255,255,255,0.1);
        }
        
        .first-checkin {
            text-align: center;
            padding: 20px;
        }
        
        .first-checkin .trophy {
            font-size: 3rem;
            margin-bottom: 15px;
        }
        
        .first-checkin .name {
            font-size: 1.3rem;
            font-weight: bold;
            margin-bottom: 5px;
        }
        
        .first-checkin .time {
            color: #4facfe;
            font-size: 1.1rem;
        }
        
        .refresh-indicator {
            position: fixed;
            bottom: 20px;
            right: 20px;
            background: rgba(79, 172, 254, 0.2);
            color: #4facfe;
            padding: 8px 15px;
            border-radius: 20px;
            font-size: 0.8rem;
            display: flex;
            align-items: center;
            gap: 8px;
            opacity: 0;
            transition: opacity 0.3s;
        }
        
        .refresh-indicator.show {
            opacity: 1;
        }
        
        .refresh-indicator .dot {
            width: 8px;
            height: 8px;
            background: #4facfe;
            border-radius: 50%;
            animation: pulse 1s infinite;
        }
        
        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.3; }
        }
    </style>
</head>
<body>
    <!-- Alert Banner -->
    <div class="alert-banner" id="alertBanner">
        <div class="alert-content">
            <span class="alert-icon">‚ö†Ô∏è</span>
            <span class="alert-message" id="alertMessage">Alert message here</span>
        </div>
        <button class="alert-close" onclick="dismissAlert()">‚úï</button>
    </div>

    <header class="header">
        <div class="logo">üìä Analytics Dashboard</div>
        <nav class="nav-links">
            <a href="{{ url_for('dashboard') }}">Dashboard</a>
            <a href="{{ url_for('branches') }}">Branches</a>
            <a href="{{ url_for('staff_list') }}">Staff</a>
            <a href="{{ url_for('reports') }}">Reports</a>
            <a href="{{ url_for('logout') }}">Logout</a>
        </nav>
        <div class="clock-container">
            <div class="analog-clock">
                <div class="clock-hand hour-hand" id="hourHand"></div>
                <div class="clock-hand minute-hand" id="minuteHand"></div>
                <div class="clock-hand second-hand" id="secondHand"></div>
                <div class="clock-center"></div>
            </div>
            <div class="digital-clock" id="digitalClock">00:00:00</div>
        </div>
    </header>
    
    <main class="main-content">
        <div class="welcome-section">
            <h1 id="greeting">Good Morning, {{ current_user.username }}! üëã</h1>
            <p id="dateDisplay"></p>
        </div>
        
        <div class="search-container">
            <div class="search-box">
                <input type="text" id="staffSearch" placeholder="üîç Search staff by name...">
            </div>
            <div class="search-results" id="searchResults"></div>
        </div>
        
        <div class="dashboard-grid">
            <div class="stat-card schools">
                <div class="stat-icon">üè´</div>
                <div class="stat-number" id="totalSchools">0</div>
                <div class="stat-label">Total Branches</div>
            </div>
            <div class="stat-card staff">
                <div class="stat-icon">üë•</div>
                <div class="stat-number" id="totalStaff">0</div>
                <div class="stat-label">Total Staff</div>
            </div>
            <div class="stat-card present">
                <div class="stat-icon">‚úÖ</div>
                <div class="stat-number" id="presentToday">0</div>
                <div class="stat-label">Present Today</div>
            </div>
            <div class="stat-card late">
                <div class="stat-icon">‚è∞</div>
                <div class="stat-number" id="lateToday">0</div>
                <div class="stat-label">Late Today</div>
            </div>
            <div class="stat-card absent">
                <div class="stat-icon">‚ùå</div>
                <div class="stat-number" id="absentToday">0</div>
                <div class="stat-label">Absent Today</div>
            </div>
        </div>
        
        <div class="content-grid">
            <div class="card">
                <h3>üìç Branch Statistics</h3>
                <table class="branch-table">
                    <thead>
                        <tr>
                            <th>Branch Name</th>
                            <th>Total Staff</th>
                            <th>Present</th>
                            <th>Late</th>
                            <th>Absent</th>
                        </tr>
                    </thead>
                    <tbody id="branchTableBody">
                        <!-- Branch rows will be inserted here -->
                    </tbody>
                </table>
            </div>
            
            <div>
                <div class="card" style="margin-bottom: 20px;">
                    <h3>üèÜ First Today</h3>
                    <div class="first-checkin" id="firstCheckin">
                        <div class="trophy">ü•á</div>
                        <div class="name">-</div>
                        <div class="time">-</div>
                    </div>
                </div>
                
                <div class="card">
                    <h3>üì¢ Live Activity</h3>
                    <div class="activity-ticker" id="activityTicker">
                        <!-- Activity items will be inserted here -->
                    </div>
                </div>
            </div>
        </div>
    </main>
    
    <!-- Refresh Indicator -->
    <div class="refresh-indicator" id="refreshIndicator">
        <span class="dot"></span>
        <span>Live</span>
    </div>

    <script>
        // Request notification permission on page load
        if ('Notification' in window) {
            if (Notification.permission === 'default') {
                Notification.requestPermission();
            }
        }
        
        // Track previous data for comparison
        let previousData = {
            present: 0,
            late: 0,
            absent: 0,
            lateStaff: []
        };
        
        // Alert banner state
        let alertDismissed = false;
        
        // Clock functions
        function updateClock() {
            const now = new Date();
            const hours = now.getHours();
            const minutes = now.getMinutes();
            const seconds = now.getSeconds();
            
            // Analog clock
            const hourDeg = (hours % 12) * 30 + minutes * 0.5;
            const minuteDeg = minutes * 6;
            const secondDeg = seconds * 6;
            
            document.getElementById('hourHand').style.transform = `rotate(${hourDeg}deg)`;
            document.getElementById('minuteHand').style.transform = `rotate(${minuteDeg}deg)`;
            document.getElementById('secondHand').style.transform = `rotate(${secondDeg}deg)`;
            
            // Digital clock
            document.getElementById('digitalClock').textContent = 
                `${hours.toString().padStart(2, '0')}:${minutes.toString().padStart(2, '0')}:${seconds.toString().padStart(2, '0')}`;
        }
        
        function updateGreeting() {
            const hour = new Date().getHours();
            let greeting = 'Good Morning';
            if (hour >= 12 && hour < 17) greeting = 'Good Afternoon';
            else if (hour >= 17) greeting = 'Good Evening';
            
            const greetingEl = document.getElementById('greeting');
            const username = greetingEl.textContent.split(',')[1] || ' User! üëã';
            greetingEl.textContent = `${greeting},${username}`;
            
            const options = { weekday: 'long', year: 'numeric', month: 'long', day: 'numeric' };
            document.getElementById('dateDisplay').textContent = new Date().toLocaleDateString('en-US', options);
        }
        
        // Show desktop notification
        function showNotification(title, body) {
            if ('Notification' in window && Notification.permission === 'granted') {
                new Notification(title, {
                    body: body,
                    icon: 'üìä',
                    badge: 'üìä'
                });
            }
        }
        
        // Alert banner functions
        function showAlert(message, type = 'warning') {
            if (alertDismissed) return;
            
            const banner = document.getElementById('alertBanner');
            const messageEl = document.getElementById('alertMessage');
            
            banner.className = `alert-banner ${type} show`;
            messageEl.textContent = message;
            
            // Update icon based on type
            const iconEl = banner.querySelector('.alert-icon');
            if (type === 'danger') iconEl.textContent = 'üö®';
            else if (type === 'warning') iconEl.textContent = '‚ö†Ô∏è';
            else iconEl.textContent = '‚úÖ';
        }
        
        function hideAlert() {
            document.getElementById('alertBanner').classList.remove('show');
        }
        
        function dismissAlert() {
            hideAlert();
            alertDismissed = true;
            // Reset after 5 minutes
            setTimeout(() => { alertDismissed = false; }, 300000);
        }
        
        // Check for alerts based on data
        function checkAlerts(data) {
            const absentThreshold = 0.3; // 30% absent
            const lateThreshold = 10; // More than 10 late
            
            let alertShown = false;
            
            // Check for high absenteeism in branches
            const highAbsentBranches = data.branches.filter(branch => {
                if (branch.total_staff === 0) return false;
                return (branch.absent / branch.total_staff) > absentThreshold;
            });
            
            if (highAbsentBranches.length > 0) {
                showAlert(`${highAbsentBranches.length} branch(es) have more than 30% absent today`, 'danger');
                alertShown = true;
            }
            
            // Check for high late count
            if (!alertShown && data.late_today > lateThreshold) {
                showAlert(`${data.late_today} staff members are late today`, 'warning');
                alertShown = true;
            }
            
            if (!alertShown) {
                hideAlert();
            }
        }
        
        // Load dashboard stats
        function loadDashboardStats(isRefresh = false) {
            fetch('/api/dashboard-stats')
                .then(response => response.json())
                .then(data => {
                    // Update stat cards
                    document.getElementById('totalSchools').textContent = data.total_schools;
                    document.getElementById('totalStaff').textContent = data.total_staff;
                    document.getElementById('presentToday').textContent = data.present_today;
                    document.getElementById('lateToday').textContent = data.late_today;
                    document.getElementById('absentToday').textContent = data.absent_today;
                    
                    // Check for new late arrivals and send notification
                    if (isRefresh && data.late_today > previousData.late) {
                        const newLateCount = data.late_today - previousData.late;
                        showNotification('Late Arrival', `${newLateCount} new staff member(s) arrived late`);
                    }
                    
                    // Check alerts
                    checkAlerts(data);
                    
                    // Update branch table (only if no row is expanded)
                    if (!document.querySelector('.staff-details.expanded')) {
                        const branchTable = document.getElementById('branchTableBody');
                        branchTable.innerHTML = '';
                        
                        data.branches.forEach(branch => {
                            const row = document.createElement('tr');
                            row.className = 'branch-row';
                            row.dataset.branchId = branch.id;
                            row.innerHTML = `
                                <td>${branch.name}</td>
                                <td>${branch.total_staff}</td>
                                <td><span class="badge badge-success">${branch.present}</span></td>
                                <td><span class="badge badge-warning">${branch.late}</span></td>
                                <td><span class="badge badge-danger">${branch.absent}</span></td>
                            `;
                            branchTable.appendChild(row);
                            
                            const detailRow = document.createElement('tr');
                            detailRow.className = 'staff-details';
                            detailRow.id = `staff-${branch.id}`;
                            detailRow.innerHTML = `
                                <td colspan="5">
                                    <div class="staff-list">
                                        <div class="loading-spinner">Loading staff...</div>
                                    </div>
                                </td>
                            `;
                            branchTable.appendChild(detailRow);
                        });
                        
                        // Reattach click handlers
                        attachBranchClickHandlers();
                    }
                    
                    // Update first check-in
                    if (data.first_checkin) {
                        document.getElementById('firstCheckin').innerHTML = `
                            <div class="trophy">ü•á</div>
                            <div class="name">${data.first_checkin.name}</div>
                            <div class="time">${data.first_checkin.time}</div>
                        `;
                    }
                    
                    // Store for next comparison
                    previousData.present = data.present_today;
                    previousData.late = data.late_today;
                    previousData.absent = data.absent_today;
                    
                    // Show refresh indicator
                    if (isRefresh) {
                        const indicator = document.getElementById('refreshIndicator');
                        indicator.classList.add('show');
                    }
                })
                .catch(error => console.log('Error loading stats:', error));
        }
        
        // Attach click handlers to branch rows
        function attachBranchClickHandlers() {
            document.querySelectorAll('.branch-row').forEach(row => {
                row.addEventListener('click', function() {
                    const branchId = this.dataset.branchId;
                    const detailRow = document.getElementById(`staff-${branchId}`);
                    const isExpanded = detailRow.classList.contains('expanded');
                    
                    // Collapse all other rows
                    document.querySelectorAll('.staff-details.expanded').forEach(el => {
                        el.classList.remove('expanded');
                    });
                    document.querySelectorAll('.branch-row.expanded').forEach(el => {
                        el.classList.remove('expanded');
                    });
                    
                    if (!isExpanded) {
                        this.classList.add('expanded');
                        detailRow.classList.add('expanded');
                        loadBranchStaff(branchId);
                    }
                });
            });
        }
        
        // Load staff for a branch
        function loadBranchStaff(branchId) {
            const staffList = document.querySelector(`#staff-${branchId} .staff-list`);
            staffList.innerHTML = '<div class="loading-spinner">Loading staff...</div>';
            
            fetch(`/api/branch-staff/${branchId}`)
                .then(response => response.json())
                .then(data => {
                    if (data.length === 0) {
                        staffList.innerHTML = '<p style="text-align: center; opacity: 0.6;">No staff found</p>';
                        return;
                    }
                    
                    let html = `
                        <table class="staff-table">
                            <thead>
                                <tr>
                                    <th>Name</th>
                                    <th>Department</th>
                                    <th>Status</th>
                                    <th>Time In</th>
                                    <th>Time Out</th>
                                </tr>
                            </thead>
                            <tbody>
                    `;
                    
                    data.forEach(staff => {
                        let badgeClass = 'badge-danger';
                        if (staff.status === 'Present') badgeClass = 'badge-success';
                        else if (staff.status === 'Late') badgeClass = 'badge-warning';
                        
                        html += `
                            <tr>
                                <td>${staff.name}</td>
                                <td>${staff.department || '-'}</td>
                                <td><span class="badge ${badgeClass}">${staff.status}</span></td>
                                <td>${staff.time_in}</td>
                                <td>${staff.time_out}</td>
                            </tr>
                        `;
                    });
                    
                    html += '</tbody></table>';
                    staffList.innerHTML = html;
                })
                .catch(error => {
                    staffList.innerHTML = '<p style="text-align: center; color: #e74c3c;">Error loading staff</p>';
                });
        }
        
        // Update activity ticker
        function updateTicker() {
            fetch('/api/dashboard-stats')
                .then(response => response.json())
                .then(data => {
                    if (data.recent_activity && data.recent_activity.length > 0) {
                        const ticker = document.getElementById('activityTicker');
                        ticker.innerHTML = '';
                        
                        data.recent_activity.forEach(activity => {
                            const initial = activity.name.charAt(0).toUpperCase();
                            ticker.innerHTML += `
                                <div class="activity-item">
                                    <div class="activity-avatar">${initial}</div>
                                    <div class="activity-info">
                                        <div class="activity-name">${activity.name}</div>
                                        <div class="activity-time">${activity.action} at ${activity.time}</div>
                                    </div>
                                </div>
                            `;
                        });
                    }
                });
        }
        
        // Staff search
        document.getElementById('staffSearch').addEventListener('input', function() {
            const query = this.value.trim();
            const resultsContainer = document.getElementById('searchResults');
            
            if (query.length < 2) {
                resultsContainer.classList.remove('show');
                return;
            }
            
            fetch(`/api/search-staff?q=${encodeURIComponent(query)}`)
                .then(response => response.json())
                .then(data => {
                    if (data.length === 0) {
                        resultsContainer.innerHTML = '<p style="padding: 15px; opacity: 0.6;">No staff found</p>';
                    } else {
                        resultsContainer.innerHTML = data.map(staff => {
                            const initial = staff.name.charAt(0).toUpperCase();
                            let statusBadge = '';
                            if (staff.status === 'Present') statusBadge = '<span class="badge badge-success">Present</span>';
                            else if (staff.status === 'Late') statusBadge = '<span class="badge badge-warning">Late</span>';
                            else statusBadge = '<span class="badge badge-danger">Absent</span>';
                            
                            return `
                                <div class="search-result-item">
                                    <div class="activity-avatar">${initial}</div>
                                    <div class="activity-info">
                                        <div class="activity-name">${staff.name}</div>
                                        <div class="activity-time">${staff.branch} ‚Ä¢ ${staff.department || 'No department'}</div>
                                    </div>
                                    ${statusBadge}
                                </div>
                            `;
                        }).join('');
                    }
                    resultsContainer.classList.add('show');
                });
        });
        
        // Auto-refresh dashboard every 60 seconds
        function refreshDashboard() {
            loadDashboardStats(true);
            updateTicker();
            console.log('Dashboard refreshed:', new Date().toLocaleTimeString());
        }
        
        // Initialize
        setInterval(updateClock, 1000);
        updateClock();
        updateGreeting();
        loadDashboardStats(false);
        updateTicker();
        
        // Show refresh indicator permanently (live mode)
        setTimeout(() => {
            document.getElementById('refreshIndicator').classList.add('show');
        }, 2000);
        
        // Auto-refresh every 60 seconds
        setInterval(refreshDashboard, 60000);
        
        // Also refresh ticker more frequently (every 30 seconds)
        setInterval(updateTicker, 30000);
    </script>
</body>
</html>
