{% extends 'base.html' %}

{% block title %}Edit Query Template - Attendance System{% endblock %}

{% block content %}
<div class="row mb-4">
    <div class="col-12">
        <div class="card border-0 shadow-lg" style="background: linear-gradient(135deg, #1e3c72 0%, #2a5298 100%);">
            <div class="card-body py-4">
                <div class="d-flex justify-content-between align-items-center flex-wrap gap-3">
                    <div>
                        <h3 class="mb-1 fw-bold text-white">
                            <i class="fas fa-edit me-2"></i>Edit Query Template
                        </h3>
                        <p class="mb-0 text-white-50"><i class="fas fa-info-circle me-1"></i> Modify your email template for staff queries</p>
                    </div>
                    <a href="{{ url_for('query_templates') }}" class="btn btn-light btn-sm">
                        <i class="fas fa-arrow-left me-1"></i> Back to Templates
                    </a>
                </div>
            </div>
        </div>
    </div>
</div>

<div class="card border-0 shadow-sm">
    <div class="card-header bg-white py-3">
        <h6 class="mb-0 fw-semibold">
            <i class="fas fa-file-alt me-2 text-primary"></i>Template Details
        </h6>
    </div>
    <div class="card-body">
        <form method="POST">
            <div class="row g-3">
                <div class="col-md-6">
                    <label class="form-label small fw-semibold">Organization</label>
                    <div class="form-control bg-light">
                        {% if template.organization %}
                        <i class="fas fa-sitemap me-2 text-info"></i>{{ template.organization.name }}
                        {% else %}
                        <span class="text-muted">N/A</span>
                        {% endif %}
                    </div>
                </div>
                
                <div class="col-md-6">
                    <label class="form-label small fw-semibold">Template Title <span class="text-danger">*</span></label>
                    <input type="text" name="title" class="form-control" value="{{ template.title }}" required>
                </div>
                
                <div class="col-12">
                    <label class="form-label small fw-semibold">Email Subject <span class="text-danger">*</span></label>
                    <input type="text" name="subject" class="form-control" value="{{ template.subject }}" required>
                    <small class="text-muted"><i class="fas fa-lightbulb me-1"></i> Placeholders: <code>{staff_name}</code>, <code>{date}</code></small>
                </div>
                
                <div class="col-12">
                    <label class="form-label small fw-semibold">Email Body <span class="text-danger">*</span></label>
                    <textarea name="body" id="editor">{{ template.body }}</textarea>
                    <div class="mt-2">
                        <small class="text-muted">
                            <i class="fas fa-lightbulb me-1"></i> Available placeholders: 
                            <code>{staff_name}</code>, 
                            <code>{times_late}</code>, 
                            <code>{date}</code>, 
                            <code>{organization_name}</code>, 
                            <code>{branch_name}</code>
                        </small>
                    </div>
                </div>
            </div>
            
            <hr class="my-4">
            
            <div class="d-flex gap-2">
                <button type="submit" class="btn btn-primary">
                    <i class="fas fa-save me-2"></i>Update Template
                </button>
                <a href="{{ url_for('query_templates') }}" class="btn btn-outline-secondary">Cancel</a>
            </div>
        </form>
    </div>
</div>

<!-- Summernote CSS -->
<link href="https://cdn.jsdelivr.net/npm/summernote@0.8.20/dist/summernote-bs5.min.css" rel="stylesheet">

<!-- Summernote JS -->
<script src="https://cdn.jsdelivr.net/npm/summernote@0.8.20/dist/summernote-bs5.min.js"></script>

<script>
$(document).ready(function() {
    $('#editor').summernote({
        height: 350,
        placeholder: 'Compose your query email here...',
        toolbar: [
            ['style', ['style']],
            ['font', ['bold', 'italic', 'underline', 'strikethrough', 'clear']],
            ['fontname', ['fontname']],
            ['fontsize', ['fontsize']],
            ['color', ['color']],
            ['para', ['ul', 'ol', 'paragraph']],
            ['table', ['table']],
            ['insert', ['link', 'hr']],
            ['view', ['fullscreen', 'codeview', 'undo', 'redo', 'help']]
        ],
        fontNames: [
            'Arial', 'Arial Black', 'Calibri', 'Cambria', 'Candara', 'Century Gothic',
            'Comic Sans MS', 'Consolas', 'Constantia', 'Corbel', 'Courier New',
            'Georgia', 'Helvetica', 'Impact', 'Lucida Console', 'Lucida Sans',
            'Open Sans', 'Palatino Linotype', 'Roboto', 'Segoe UI', 'Tahoma',
            'Times New Roman', 'Trebuchet MS', 'Verdana'
        ],
        fontNamesIgnoreCheck: ['Calibri', 'Cambria', 'Candara', 'Century Gothic', 'Consolas', 'Constantia', 'Corbel', 'Lucida Sans', 'Open Sans', 'Roboto', 'Segoe UI'],
        fontSizes: ['8', '9', '10', '11', '12', '14', '16', '18', '20', '24', '28', '32', '36', '48', '72'],
        styleTags: ['p', 'h1', 'h2', 'h3', 'h4', 'h5', 'h6'],
        callbacks: {
            onInit: function() {
                $('.note-editable').css('font-family', 'Arial, sans-serif');
                $('.note-editable').css('font-size', '12pt');
            }
        }
    });
});
</script>

<style>
.note-editor.note-frame {
    border: 1px solid #dee2e6;
    border-radius: 0.5rem;
}

.note-editor.note-frame .note-editing-area .note-editable {
    padding: 15px;
    background-color: #fff;
}

.note-toolbar {
    background-color: #f8f9fc;
    border-bottom: 1px solid #dee2e6;
    border-radius: 0.5rem 0.5rem 0 0;
    padding: 8px;
}

.note-btn {
    border-radius: 4px !important;
}

.text-white-50 {
    color: rgba(255, 255, 255, 0.7) !important;
}

.card {
    border-radius: 0.75rem;
}

code {
    background-color: #e9ecef;
    padding: 2px 6px;
    border-radius: 4px;
    color: #d63384;
}
</style>
{% endblock %}
