<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>Analytics Report</title>
    <style>
        @page {
            size: A4;
            margin: 1cm;
        }
        
        body {
            font-family: Helvetica, Arial, sans-serif;
            font-size: 10px;
            color: #333;
            line-height: 1.5;
        }
        
        /* Header */
        .header {
            background-color: #667eea;
            color: white;
            padding: 25px;
            text-align: center;
            margin-bottom: 20px;
        }
        
        .header h1 {
            margin: 0;
            font-size: 26px;
            font-weight: bold;
        }
        
        .header p {
            margin: 8px 0 0 0;
            font-size: 12px;
        }
        
        /* Filter Bar */
        .filter-bar {
            background-color: #f8f9fc;
            border: 1px solid #e3e6f0;
            padding: 12px 15px;
            margin-bottom: 20px;
        }
        
        .filter-bar span {
            margin-right: 25px;
            font-size: 10px;
        }
        
        .filter-bar strong {
            color: #333;
        }
        
        /* Metrics Table */
        .metrics-table {
            width: 100%;
            border-collapse: collapse;
            margin-bottom: 20px;
        }
        
        .metrics-table td {
            width: 25%;
            padding: 15px;
            text-align: center;
            border: 1px solid #e0e0e0;
        }
        
        .metric-red { background-color: #fff5f5; }
        .metric-green { background-color: #f0fff4; }
        .metric-blue { background-color: #f0f7ff; }
        .metric-purple { background-color: #f8f5ff; }
        .metric-teal { background-color: #f0fdff; }
        .metric-orange { background-color: #fff9f0; }
        .metric-pink { background-color: #fff5f9; }
        .metric-gray { background-color: #f8f9fa; }
        
        .metric-value {
            font-size: 28px;
            font-weight: bold;
            margin-bottom: 5px;
        }
        
        .metric-red .metric-value { color: #dc3545; }
        .metric-green .metric-value { color: #28a745; }
        .metric-blue .metric-value { color: #007bff; }
        .metric-purple .metric-value { color: #6f42c1; }
        .metric-teal .metric-value { color: #17a2b8; }
        .metric-orange .metric-value { color: #fd7e14; }
        .metric-pink .metric-value { color: #e83e8c; }
        .metric-gray .metric-value { color: #495057; }
        
        .metric-label {
            font-size: 9px;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            color: #666;
            font-weight: bold;
        }
        
        .metric-trend {
            font-size: 9px;
            margin-top: 5px;
            padding: 3px 8px;
            display: inline-block;
        }
        
        .trend-up { background-color: #d4edda; color: #155724; }
        .trend-down { background-color: #f8d7da; color: #721c24; }
        
        /* Summary Box */
        .summary-box {
            background-color: #f8f9fc;
            border-left: 4px solid #667eea;
            padding: 15px;
            margin-bottom: 20px;
        }
        
        .summary-box h3 {
            margin: 0 0 10px 0;
            color: #667eea;
            font-size: 14px;
        }
        
        .summary-box p {
            margin: 0;
            font-size: 10px;
            line-height: 1.6;
        }
        
        /* Section Headers */
        .section-header {
            color: white;
            padding: 10px 15px;
            font-size: 12px;
            font-weight: bold;
            margin: 20px 0 0 0;
        }
        
        .section-green { background-color: #28a745; }
        .section-red { background-color: #dc3545; }
        .section-teal { background-color: #17a2b8; }
        .section-purple { background-color: #6f42c1; }
        .section-orange { background-color: #fd7e14; }
        .section-cyan { background-color: #20c997; }
        
        /* Data Tables */
        .data-table {
            width: 100%;
            border-collapse: collapse;
            margin-bottom: 15px;
        }
        
        .data-table th {
            background-color: #f8f9fc;
            padding: 10px;
            text-align: left;
            font-size: 9px;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            color: #666;
            border-bottom: 2px solid #e3e6f0;
        }
        
        .data-table td {
            padding: 10px;
            border-bottom: 1px solid #f0f0f0;
            font-size: 10px;
        }
        
        .data-table tr:nth-child(even) {
            background-color: #fafbfc;
        }
        
        /* Badges */
        .badge {
            padding: 4px 10px;
            font-size: 9px;
            font-weight: bold;
            display: inline-block;
        }
        
        .badge-success { background-color: #d4edda; color: #155724; }
        .badge-danger { background-color: #f8d7da; color: #721c24; }
        .badge-info { background-color: #d1ecf1; color: #0c5460; }
        .badge-purple { background-color: #e2d9f3; color: #4a2c82; }
        .badge-orange { background-color: #ffecd2; color: #8a4500; }
        .badge-secondary { background-color: #e9ecef; color: #495057; }
        
        /* Rank Numbers */
        .rank {
            display: inline-block;
            width: 24px;
            height: 24px;
            text-align: center;
            line-height: 24px;
            font-weight: bold;
            font-size: 11px;
        }
        
        .rank-gold { background-color: #ffd700; color: #664d00; }
        .rank-silver { background-color: #c0c0c0; color: #333; }
        .rank-bronze { background-color: #cd7f32; color: #fff; }
        .rank-default { background-color: #e9ecef; color: #495057; }
        
        /* Two Column Layout */
        .two-col-table {
            width: 100%;
            border-collapse: collapse;
        }
        
        .two-col-table > tbody > tr > td {
            width: 50%;
            vertical-align: top;
            padding: 0 8px;
        }
        
        /* Footer */
        .footer {
            text-align: center;
            font-size: 9px;
            color: #999;
            margin-top: 30px;
            padding-top: 15px;
            border-top: 1px solid #e3e6f0;
        }
    </style>
</head>
<body>
    <!-- Header -->
    <div class="header">
        <h1>Attendance Analytics Report</h1>
        <p>Generated on {{ generated_date }}</p>
    </div>
    
    <!-- Filter Bar -->
    <div class="filter-bar">
        <span><strong>Period:</strong> {{ start_date }} to {{ end_date }}</span>
        {% if selected_branch %}<span><strong>Branch:</strong> {{ selected_branch }}</span>{% endif %}
        {% if selected_department %}<span><strong>Department:</strong> {{ selected_department }}</span>{% endif %}
    </div>
    
    <!-- Metrics Row 1 -->
    <table class="metrics-table">
        <tr>
            <td class="metric-red">
                <div class="metric-value">{{ attendance_rate }}%</div>
                <div class="metric-label">Attendance Rate</div>
                <div class="metric-trend {% if attendance_trend >= 0 %}trend-up{% else %}trend-down{% endif %}">
                    {% if attendance_trend >= 0 %}▲{% else %}▼{% endif %} {{ attendance_trend|abs }}% vs prev
                </div>
            </td>
            <td class="metric-green">
                <div class="metric-value">{{ punctuality_rate }}%</div>
                <div class="metric-label">Punctuality Rate</div>
                <div class="metric-trend {% if punctuality_trend >= 0 %}trend-up{% else %}trend-down{% endif %}">
                    {% if punctuality_trend >= 0 %}▲{% else %}▼{% endif %} {{ punctuality_trend|abs }}% vs prev
                </div>
            </td>
            <td class="metric-blue">
                <div class="metric-value">{{ total_staff }}</div>
                <div class="metric-label">Active Staff</div>
                <div class="metric-trend trend-up">{{ branch_count }} branches</div>
            </td>
            <td class="metric-purple">
                <div class="metric-value">{{ total_records }}</div>
                <div class="metric-label">Total Records</div>
                <div class="metric-trend trend-up">In period</div>
            </td>
        </tr>
    </table>
    
    <!-- Metrics Row 2 -->
    <table class="metrics-table">
        <tr>
            <td class="metric-teal">
                <div class="metric-value">{{ on_time_count }}</div>
                <div class="metric-label">On-Time Arrivals</div>
            </td>
            <td class="metric-orange">
                <div class="metric-value">{{ late_count }}</div>
                <div class="metric-label">Late Arrivals</div>
            </td>
            <td class="metric-pink">
                <div class="metric-value">{{ avg_late_minutes }} min</div>
                <div class="metric-label">Avg Late Time</div>
            </td>
            <td class="metric-gray">
                <div class="metric-value">{{ overtime_hours }}h {{ overtime_mins }}m</div>
                <div class="metric-label">Total Overtime</div>
            </td>
        </tr>
    </table>
    
    <!-- Executive Summary -->
    <div class="summary-box">
        <h3>Executive Summary</h3>
        <p>
            During the selected period, <strong>{{ total_staff }} staff members</strong> recorded 
            <strong>{{ total_records }} attendance entries</strong>. 
            The overall attendance rate was <strong>{{ attendance_rate }}%</strong> 
            {% if attendance_trend >= 0 %}
            (an improvement of {{ attendance_trend }}% compared to the previous period).
            {% else %}
            (a decrease of {{ attendance_trend|abs }}% compared to the previous period).
            {% endif %}
            Punctuality stood at <strong>{{ punctuality_rate }}%</strong> with 
            <strong>{{ on_time_count }} on-time arrivals</strong> and 
            <strong>{{ late_count }} late arrivals</strong>.
            {% if late_count > 0 %}
            The average late time was <strong>{{ avg_late_minutes }} minutes</strong>.
            {% endif %}
        </p>
    </div>
    
    <!-- Rankings Row 1 -->
    <table class="two-col-table">
        <tr>
            <td>
                <div class="section-header section-green">Top Performers</div>
                <table class="data-table">
                    <thead>
                        <tr>
                            <th style="width: 40px;">Rank</th>
                            <th>Staff Member</th>
                            <th>Branch</th>
                            <th style="text-align: right;">Score</th>
                        </tr>
                    </thead>
                    <tbody>
                        {% for staff in top_performers[:5] %}
                        <tr>
                            <td>
                                {% if loop.index == 1 %}<span class="rank rank-gold">1</span>
                                {% elif loop.index == 2 %}<span class="rank rank-silver">2</span>
                                {% elif loop.index == 3 %}<span class="rank rank-bronze">3</span>
                                {% else %}<span class="rank rank-default">{{ loop.index }}</span>{% endif %}
                            </td>
                            <td><strong>{{ staff.name }}</strong></td>
                            <td><span class="badge badge-secondary">{{ staff.branch }}</span></td>
                            <td style="text-align: right;"><span class="badge badge-success">{{ staff.punctuality }}%</span></td>
                        </tr>
                        {% else %}
                        <tr><td colspan="4" style="text-align: center; color: #999;">No data available</td></tr>
                        {% endfor %}
                    </tbody>
                </table>
            </td>
            <td>
                <div class="section-header section-red">Needs Attention</div>
                <table class="data-table">
                    <thead>
                        <tr>
                            <th style="width: 40px;">#</th>
                            <th>Staff Member</th>
                            <th>Branch</th>
                            <th style="text-align: right;">Late</th>
                        </tr>
                    </thead>
                    <tbody>
                        {% for staff in needs_attention[:5] %}
                        <tr>
                            <td><span class="rank rank-default">{{ loop.index }}</span></td>
                            <td><strong>{{ staff.name }}</strong></td>
                            <td><span class="badge badge-secondary">{{ staff.branch }}</span></td>
                            <td style="text-align: right;"><span class="badge badge-danger">{{ staff.late_count }}x</span></td>
                        </tr>
                        {% else %}
                        <tr><td colspan="4" style="text-align: center; color: #999;">No data available</td></tr>
                        {% endfor %}
                    </tbody>
                </table>
            </td>
        </tr>
    </table>
    
    <!-- Rankings Row 2 -->
    <table class="two-col-table">
        <tr>
            <td>
                <div class="section-header section-teal">Early Arrivals Champions</div>
                <table class="data-table">
                    <thead>
                        <tr>
                            <th style="width: 40px;">Rank</th>
                            <th>Staff Member</th>
                            <th>Branch</th>
                            <th style="text-align: right;">Avg Early</th>
                        </tr>
                    </thead>
                    <tbody>
                        {% for staff in early_arrivals[:5] %}
                        <tr>
                            <td>
                                {% if loop.index == 1 %}<span class="rank rank-gold">1</span>
                                {% elif loop.index == 2 %}<span class="rank rank-silver">2</span>
                                {% elif loop.index == 3 %}<span class="rank rank-bronze">3</span>
                                {% else %}<span class="rank rank-default">{{ loop.index }}</span>{% endif %}
                            </td>
                            <td><strong>{{ staff.name }}</strong></td>
                            <td><span class="badge badge-secondary">{{ staff.branch }}</span></td>
                            <td style="text-align: right;"><span class="badge badge-info">{{ staff.avg_early_mins }} min</span></td>
                        </tr>
                        {% else %}
                        <tr><td colspan="4" style="text-align: center; color: #999;">No data available</td></tr>
                        {% endfor %}
                    </tbody>
                </table>
            </td>
            <td>
                <div class="section-header section-purple">Perfect Attendance</div>
                <table class="data-table">
                    <thead>
                        <tr>
                            <th style="width: 40px;">★</th>
                            <th>Staff Member</th>
                            <th>Branch</th>
                            <th style="text-align: right;">Days</th>
                        </tr>
                    </thead>
                    <tbody>
                        {% for staff in perfect_attendance[:5] %}
                        <tr>
                            <td><span class="rank rank-gold">★</span></td>
                            <td><strong>{{ staff.name }}</strong></td>
                            <td><span class="badge badge-secondary">{{ staff.branch }}</span></td>
                            <td style="text-align: right;"><span class="badge badge-purple">{{ staff.days }} days</span></td>
                        </tr>
                        {% else %}
                        <tr><td colspan="4" style="text-align: center; color: #999;">No data available</td></tr>
                        {% endfor %}
                    </tbody>
                </table>
            </td>
        </tr>
    </table>
    
    <!-- Rankings Row 3 -->
    <table class="two-col-table">
        <tr>
            <td>
                <div class="section-header section-orange">Most Improved</div>
                <table class="data-table">
                    <thead>
                        <tr>
                            <th style="width: 40px;">Rank</th>
                            <th>Staff Member</th>
                            <th>Branch</th>
                            <th style="text-align: right;">Improved</th>
                        </tr>
                    </thead>
                    <tbody>
                        {% for staff in most_improved[:5] %}
                        <tr>
                            <td>
                                {% if loop.index == 1 %}<span class="rank rank-gold">1</span>
                                {% elif loop.index == 2 %}<span class="rank rank-silver">2</span>
                                {% elif loop.index == 3 %}<span class="rank rank-bronze">3</span>
                                {% else %}<span class="rank rank-default">{{ loop.index }}</span>{% endif %}
                            </td>
                            <td><strong>{{ staff.name }}</strong></td>
                            <td><span class="badge badge-secondary">{{ staff.branch }}</span></td>
                            <td style="text-align: right;"><span class="badge badge-success">-{{ staff.reduction }} late</span></td>
                        </tr>
                        {% else %}
                        <tr><td colspan="4" style="text-align: center; color: #999;">No data available</td></tr>
                        {% endfor %}
                    </tbody>
                </table>
            </td>
            <td>
                <div class="section-header section-cyan">On-Time Streaks</div>
                <table class="data-table">
                    <thead>
                        <tr>
                            <th style="width: 40px;">Rank</th>
                            <th>Staff Member</th>
                            <th>Branch</th>
                            <th style="text-align: right;">Streak</th>
                        </tr>
                    </thead>
                    <tbody>
                        {% for staff in attendance_streaks[:5] %}
                        <tr>
                            <td>
                                {% if loop.index == 1 %}<span class="rank rank-gold">1</span>
                                {% elif loop.index == 2 %}<span class="rank rank-silver">2</span>
                                {% elif loop.index == 3 %}<span class="rank rank-bronze">3</span>
                                {% else %}<span class="rank rank-default">{{ loop.index }}</span>{% endif %}
                            </td>
                            <td><strong>{{ staff.name }}</strong></td>
                            <td><span class="badge badge-secondary">{{ staff.branch }}</span></td>
                            <td style="text-align: right;"><span class="badge badge-orange">{{ staff.streak }} days</span></td>
                        </tr>
                        {% else %}
                        <tr><td colspan="4" style="text-align: center; color: #999;">No data available</td></tr>
                        {% endfor %}
                    </tbody>
                </table>
            </td>
        </tr>
    </table>
    
    <!-- Footer -->
    <div class="footer">
        <p>This report was automatically generated by the Attendance Management System</p>
        <p>© {{ current_year }} - Confidential</p>
    </div>
</body>
</html>
