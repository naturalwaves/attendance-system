{% extends 'base.html' %}

{% block title %}Add Query Template - Attendance System{% endblock %}

{% block content %}
<div class="d-flex justify-content-between align-items-center mb-4">
    <h2><i class="fas fa-plus me-2"></i>Add Query Template</h2>
    <a href="{{ url_for('query_templates') }}" class="btn btn-secondary">
        <i class="fas fa-arrow-left me-2"></i>Back
    </a>
</div>

<div class="card">
    <div class="card-body">
        <form method="POST">
            <div class="mb-3">
                <label class="form-label">Organization <span class="text-danger">*</span></label>
                <select name="organization_id" class="form-select" required>
                    <option value="">Select Organization</option>
                    {% for org in organizations %}
                    <option value="{{ org.id }}">{{ org.name }}</option>
                    {% endfor %}
                </select>
            </div>
            
            <div class="mb-3">
                <label class="form-label">Template Title <span class="text-danger">*</span></label>
                <input type="text" name="title" class="form-control" placeholder="e.g., Lateness Query - First Warning" required>
            </div>
            
            <div class="mb-3">
                <label class="form-label">Email Subject <span class="text-danger">*</span></label>
                <input type="text" name="subject" class="form-control" placeholder="e.g., Query Regarding Your Attendance - {date}" required>
                <small class="text-muted">You can use: {staff_name}, {date}</small>
            </div>
            
            <div class="mb-3">
                <label class="form-label">Email Body <span class="text-danger">*</span></label>
                <textarea name="body" id="editor"></textarea>
                <small class="text-muted">Available placeholders: {staff_name}, {times_late}, {date}, {organization_name}, {branch_name}</small>
            </div>
            
            <div class="d-flex gap-2">
                <button type="submit" class="btn btn-primary">
                    <i class="fas fa-save me-2"></i>Save Template
                </button>
                <a href="{{ url_for('query_templates') }}" class="btn btn-secondary">Cancel</a>
            </div>
        </form>
    </div>
</div>

<!-- TinyMCE CDN -->
<script src="https://cdn.tiny.cloud/1/no-api-key/tinymce/6/tinymce.min.js" referrerpolicy="origin"></script>
<script>
tinymce.init({
    selector: '#editor',
    height: 400,
    plugins: 'anchor autolink charmap codesample emoticons image link lists media searchreplace table visualblocks wordcount',
    toolbar: 'undo redo | fontfamily fontsize | bold italic underline strikethrough | forecolor backcolor | alignleft aligncenter alignright alignjustify | bullist numlist outdent indent | link table | removeformat',
    font_family_formats: `
        Andale Mono=andale mono,times;
        Arial=arial,helvetica,sans-serif;
        Arial Black=arial black,avant garde;
        Book Antiqua=book antiqua,palatino;
        Calibri=calibri,sans-serif;
        Cambria=cambria,serif;
        Candara=candara,sans-serif;
        Century Gothic=century gothic,sans-serif;
        Comic Sans MS=comic sans ms,sans-serif;
        Consolas=consolas,monaco,monospace;
        Constantia=constantia,serif;
        Corbel=corbel,sans-serif;
        Courier New=courier new,courier;
        Georgia=georgia,palatino;
        Helvetica=helvetica;
        Impact=impact,chicago;
        Lucida Console=lucida console,monaco;
        Lucida Sans=lucida sans unicode,lucida grande,sans-serif;
        Open Sans=open sans,sans-serif;
        Palatino Linotype=palatino linotype,book antiqua,palatino;
        Roboto=roboto,sans-serif;
        Segoe UI=segoe ui,sans-serif;
        Tahoma=tahoma,arial,helvetica,sans-serif;
        Times New Roman=times new roman,times;
        Trebuchet MS=trebuchet ms,geneva;
        Verdana=verdana,geneva;
    `,
    fontsize_formats: '8pt 9pt 10pt 11pt 12pt 14pt 16pt 18pt 20pt 24pt 28pt 32pt 36pt 48pt 72pt',
    content_style: `
        @import url('https://fonts.googleapis.com/css2?family=Open+Sans:wght@400;600;700&family=Roboto:wght@400;500;700&display=swap');
        body { font-family: Arial, sans-serif; font-size: 12pt; }
    `,
    menubar: false,
    branding: false,
    promotion: false,
    setup: function(editor) {
        editor.on('change', function() {
            editor.save();
        });
    }
});
</script>
{% endblock %}
