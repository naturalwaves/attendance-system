{% extends 'base.html' %}

{% block title %}Add Query Template - Attendance System{% endblock %}

{% block content %}
<div class="row mb-4">
    <div class="col-12">
        <div class="card border-0 shadow-lg" style="background: linear-gradient(135deg, #1e3c72 0%, #2a5298 100%);">
            <div class="card-body py-4">
                <div class="d-flex justify-content-between align-items-center flex-wrap gap-3">
                    <div>
                        <h3 class="mb-1 fw-bold text-white">
                            <i class="fas fa-plus-circle me-2"></i>Add Query Template
                        </h3>
                        <p class="mb-0 text-white-50"><i class="fas fa-info-circle me-1"></i> Create a new email template for staff queries</p>
                    </div>
                    <a href="{{ url_for('query_templates') }}" class="btn btn-light btn-sm">
                        <i class="fas fa-arrow-left me-1"></i> Back to Templates
                    </a>
                </div>
            </div>
        </div>
    </div>
</div>

<form method="POST" id="templateForm">
    <!-- Template Info Card -->
    <div class="card border-0 shadow-sm mb-4">
        <div class="card-header bg-white py-3">
            <h6 class="mb-0 fw-semibold">
                <i class="fas fa-info-circle me-2 text-primary"></i>Template Information
            </h6>
        </div>
        <div class="card-body">
            <div class="row g-3">
                <div class="col-md-4">
                    <label class="form-label small fw-semibold">Organization <span class="text-danger">*</span></label>
                    <select name="organization_id" class="form-select" required>
                        <option value="">Select Organization</option>
                        {% for org in organizations %}
                        <option value="{{ org.id }}">{{ org.name }}</option>
                        {% endfor %}
                    </select>
                </div>
                
                <div class="col-md-4">
                    <label class="form-label small fw-semibold">Template Title <span class="text-danger">*</span></label>
                    <input type="text" name="title" class="form-control" placeholder="e.g., Lateness Query - First Warning" required>
                </div>
                
                <div class="col-md-4">
                    <label class="form-label small fw-semibold">Email Subject <span class="text-danger">*</span></label>
                    <input type="text" name="subject" class="form-control" placeholder="e.g., Query Regarding Your Attendance - {date}" required>
                </div>
            </div>
            <div class="mt-2">
                <small class="text-muted"><i class="fas fa-lightbulb me-1"></i> Subject placeholders: <code>{staff_name}</code>, <code>{date}</code></small>
            </div>
        </div>
    </div>

    <!-- Email Body Card -->
    <div class="card border-0 shadow-sm mb-4">
        <div class="card-header bg-white py-3">
            <h6 class="mb-0 fw-semibold">
                <i class="fas fa-envelope me-2 text-primary"></i>Email Body <span class="text-danger">*</span>
            </h6>
        </div>
        <div class="card-body p-0">
            <div id="toolbar">
                <select class="ql-font">
                    <option selected>Sans Serif</option>
                    <option value="serif">Serif</option>
                    <option value="monospace">Monospace</option>
                    <option value="arial">Arial</option>
                    <option value="times-new-roman">Times New Roman</option>
                    <option value="georgia">Georgia</option>
                    <option value="verdana">Verdana</option>
                    <option value="tahoma">Tahoma</option>
                </select>
                <select class="ql-size">
                    <option value="small">Small</option>
                    <option selected>Normal</option>
                    <option value="large">Large</option>
                    <option value="huge">Huge</option>
                </select>
                <button class="ql-bold"></button>
                <button class="ql-italic"></button>
                <button class="ql-underline"></button>
                <button class="ql-strike"></button>
                <select class="ql-color"></select>
                <select class="ql-background"></select>
                <select class="ql-align">
                    <option selected></option>
                    <option value="center"></option>
                    <option value="right"></option>
                    <option value="justify"></option>
                </select>
                <button class="ql-list" value="ordered"></button>
                <button class="ql-list" value="bullet"></button>
                <button class="ql-indent" value="-1"></button>
                <button class="ql-indent" value="+1"></button>
                <button class="ql-link"></button>
                <button class="ql-clean"></button>
            </div>
            <div id="editor"></div>
            <input type="hidden" name="body" id="body-input">
        </div>
        <div class="card-footer bg-light">
            <small class="text-muted">
                <i class="fas fa-lightbulb me-1"></i> Available placeholders: 
                <code>{staff_name}</code>, 
                <code>{times_late}</code>, 
                <code>{date}</code>, 
                <code>{organization_name}</code>, 
                <code>{branch_name}</code>
            </small>
        </div>
    </div>

    <!-- Action Buttons -->
    <div class="card border-0 shadow-sm">
        <div class="card-body">
            <div class="d-flex gap-2">
                <button type="submit" class="btn btn-primary btn-lg">
                    <i class="fas fa-save me-2"></i>Save Template
                </button>
                <a href="{{ url_for('query_templates') }}" class="btn btn-outline-secondary btn-lg">Cancel</a>
            </div>
        </div>
    </div>
</form>

<!-- Quill CSS -->
<link href="https://cdn.quilljs.com/1.3.7/quill.snow.css" rel="stylesheet">

<!-- Quill JS -->
<script src="https://cdn.quilljs.com/1.3.7/quill.min.js"></script>

<script>
// Register custom fonts
var Font = Quill.import('formats/font');
Font.whitelist = ['sans-serif', 'serif', 'monospace', 'arial', 'times-new-roman', 'georgia', 'verdana', 'tahoma'];
Quill.register(Font, true);

// Initialize Quill
var quill = new Quill('#editor', {
    modules: {
        toolbar: '#toolbar'
    },
    theme: 'snow',
    placeholder: 'Compose your query email here...'
});

// Sync content on form submit
document.getElementById('templateForm').addEventListener('submit', function(e) {
    document.getElementById('body-input').value = quill.root.innerHTML;
});
</script>

<style>
#editor {
    min-height: 500px;
    font-size: 16px;
    line-height: 1.8;
}

#toolbar {
    background-color: #f8f9fc;
    border: none;
    border-bottom: 1px solid #dee2e6;
    padding: 10px;
}

.ql-container {
    border: none !important;
    font-size: 16px;
}

.ql-toolbar.ql-snow {
    border: none !important;
    border-bottom: 1px solid #dee2e6 !important;
    background-color: #f8f9fc;
    padding: 12px;
}

.ql-editor {
    padding: 20px;
    min-height: 500px;
}

.ql-editor.ql-blank::before {
    font-style: normal;
    color: #adb5bd;
}

/* Custom font styles */
.ql-font-arial { font-family: Arial, sans-serif; }
.ql-font-times-new-roman { font-family: 'Times New Roman', Times, serif; }
.ql-font-georgia { font-family: Georgia, serif; }
.ql-font-verdana { font-family: Verdana, Geneva, sans-serif; }
.ql-font-tahoma { font-family: Tahoma, Geneva, sans-serif; }

.ql-picker.ql-font .ql-picker-label[data-value="arial"]::before,
.ql-picker.ql-font .ql-picker-item[data-value="arial"]::before { content: 'Arial'; font-family: Arial; }

.ql-picker.ql-font .ql-picker-label[data-value="times-new-roman"]::before,
.ql-picker.ql-font .ql-picker-item[data-value="times-new-roman"]::before { content: 'Times New Roman'; font-family: 'Times New Roman'; }

.ql-picker.ql-font .ql-picker-label[data-value="georgia"]::before,
.ql-picker.ql-font .ql-picker-item[data-value="georgia"]::before { content: 'Georgia'; font-family: Georgia; }

.ql-picker.ql-font .ql-picker-label[data-value="verdana"]::before,
.ql-picker.ql-font .ql-picker-item[data-value="verdana"]::before { content: 'Verdana'; font-family: Verdana; }

.ql-picker.ql-font .ql-picker-label[data-value="tahoma"]::before,
.ql-picker.ql-font .ql-picker-item[data-value="tahoma"]::before { content: 'Tahoma'; font-family: Tahoma; }

.text-white-50 {
    color: rgba(255, 255, 255, 0.7) !important;
}

.card {
    border-radius: 0.75rem;
}

code {
    background-color: #e9ecef;
    padding: 2px 6px;
    border-radius: 4px;
    color: #d63384;
}
</style>
{% endblock %}
