{% extends 'base.html' %}

{% block title %}Add Query Template - Attendance System{% endblock %}

{% block content %}
<div class="row mb-4">
    <div class="col-12">
        <div class="card border-0 shadow-lg" style="background: linear-gradient(135deg, #1e3c72 0%, #2a5298 100%);">
            <div class="card-body py-4">
                <div class="d-flex justify-content-between align-items-center flex-wrap gap-3">
                    <div>
                        <h3 class="mb-1 fw-bold text-white">
                            <i class="fas fa-plus-circle me-2"></i>Add Query Template
                        </h3>
                        <p class="mb-0 text-white-50"><i class="fas fa-info-circle me-1"></i> Create a new email template for staff queries</p>
                    </div>
                    <a href="{{ url_for('query_templates') }}" class="btn btn-light btn-sm">
                        <i class="fas fa-arrow-left me-1"></i> Back to Templates
                    </a>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Template Info Card -->
<div class="card border-0 shadow-sm mb-4">
    <div class="card-header bg-white py-3">
        <h6 class="mb-0 fw-semibold">
            <i class="fas fa-info-circle me-2 text-primary"></i>Template Information
        </h6>
    </div>
    <div class="card-body">
        <form method="POST" id="templateForm">
            <div class="row g-3">
                <div class="col-md-4">
                    <label class="form-label small fw-semibold">Organization <span class="text-danger">*</span></label>
                    <select name="organization_id" class="form-select" required>
                        <option value="">Select Organization</option>
                        {% for org in organizations %}
                        <option value="{{ org.id }}">{{ org.name }}</option>
                        {% endfor %}
                    </select>
                </div>
                
                <div class="col-md-4">
                    <label class="form-label small fw-semibold">Template Title <span class="text-danger">*</span></label>
                    <input type="text" name="title" class="form-control" placeholder="e.g., Lateness Query - First Warning" required>
                </div>
                
                <div class="col-md-4">
                    <label class="form-label small fw-semibold">Email Subject <span class="text-danger">*</span></label>
                    <input type="text" name="subject" class="form-control" placeholder="e.g., Query Regarding Your Attendance - {date}" required>
                </div>
            </div>
            <div class="mt-2">
                <small class="text-muted"><i class="fas fa-lightbulb me-1"></i> Subject placeholders: <code>{staff_name}</code>, <code>{date}</code></small>
            </div>
        </form>
    </div>
</div>

<!-- Email Body Card - Full Width -->
<div class="card border-0 shadow-sm mb-4">
    <div class="card-header bg-white py-3">
        <h6 class="mb-0 fw-semibold">
            <i class="fas fa-envelope me-2 text-primary"></i>Email Body <span class="text-danger">*</span>
        </h6>
    </div>
    <div class="card-body p-0">
        <textarea name="body" id="editor" form="templateForm"></textarea>
    </div>
    <div class="card-footer bg-light">
        <small class="text-muted">
            <i class="fas fa-lightbulb me-1"></i> Available placeholders: 
            <code>{staff_name}</code>, 
            <code>{times_late}</code>, 
            <code>{date}</code>, 
            <code>{organization_name}</code>, 
            <code>{branch_name}</code>
        </small>
    </div>
</div>

<!-- Action Buttons -->
<div class="card border-0 shadow-sm">
    <div class="card-body">
        <div class="d-flex gap-2">
            <button type="submit" form="templateForm" class="btn btn-primary btn-lg">
                <i class="fas fa-save me-2"></i>Save Template
            </button>
            <a href="{{ url_for('query_templates') }}" class="btn btn-outline-secondary btn-lg">Cancel</a>
        </div>
    </div>
</div>

<!-- Summernote CSS -->
<link href="https://cdn.jsdelivr.net/npm/summernote@0.8.20/dist/summernote-bs5.min.css" rel="stylesheet">

<!-- Summernote JS -->
<script src="https://cdn.jsdelivr.net/npm/summernote@0.8.20/dist/summernote-bs5.min.js"></script>

<script>
$(document).ready(function() {
    $('#editor').summernote({
        height: 700,
        placeholder: 'Compose your query email here...\n\nTip: You can use placeholders like {staff_name} which will be replaced with actual values when sending.',
        toolbar: [
            ['style', ['style']],
            ['font', ['bold', 'italic', 'underline', 'strikethrough', 'clear']],
            ['fontname', ['fontname']],
            ['fontsize', ['fontsize']],
            ['color', ['color']],
            ['para', ['ul', 'ol', 'paragraph']],
            ['height', ['height']],
            ['table', ['table']],
            ['insert', ['link', 'hr']],
            ['view', ['fullscreen', 'codeview', 'undo', 'redo', 'help']]
        ],
        fontNames: [
            'Arial', 'Arial Black', 'Calibri', 'Cambria', 'Candara', 'Century Gothic',
            'Comic Sans MS', 'Consolas', 'Constantia', 'Corbel', 'Courier New',
            'Georgia', 'Helvetica', 'Impact', 'Lucida Console', 'Lucida Sans',
            'Open Sans', 'Palatino Linotype', 'Roboto', 'Segoe UI', 'Tahoma',
            'Times New Roman', 'Trebuchet MS', 'Verdana'
        ],
        fontNamesIgnoreCheck: ['Calibri', 'Cambria', 'Candara', 'Century Gothic', 'Consolas', 'Constantia', 'Corbel', 'Lucida Sans', 'Open Sans', 'Roboto', 'Segoe UI'],
        fontSizes: ['8', '9', '10', '11', '12', '14', '16', '18', '20', '24', '28', '32', '36', '48', '72'],
        styleTags: ['p', 'h1', 'h2', 'h3', 'h4', 'h5', 'h6'],
        callbacks: {
            onInit: function() {
                $('.note-editable').css('font-family', 'Arial, sans-serif');
                $('.note-editable').css('font-size', '14px');
                $('.note-editable').css('line-height', '1.6');
            }
        }
    });
});
</script>

<style>
.note-editor.note-frame {
    border: none !important;
    border-radius: 0;
}

.note-editor.note-frame .note-editing-area .note-editable {
    padding: 25px;
    background-color: #fff;
    min-height: 700px;
}

.note-toolbar {
    background-color: #f8f9fc;
    border-bottom: 1px solid #dee2e6;
    padding: 10px 15px;
}

.note-btn {
    border-radius: 4px !important;
}

.note-toolbar .note-btn-group {
    margin-right: 8px;
}

.text-white-50 {
    color: rgba(255, 255, 255, 0.7) !important;
}

.card {
    border-radius: 0.75rem;
}

code {
    background-color: #e9ecef;
    padding: 2px 6px;
    border-radius: 4px;
    color: #d63384;
}

.note-editable {
    font-size: 14px !important;
}
</style>
{% endblock %}
